<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=414, initial-scale=1, viewport-fit=cover" />
  <title>관리자</title>
  <link rel="stylesheet" href="assets/app.css" />
</head>
<body>
  <div id="toast" class="toast hidden"></div>
  <main class="container">

  <section class="card">
    <h2>관리자</h2>
    <div class="row">
      <div class="col">
        <h3>알림 보내기</h3>
        <label>내용</label>
        <textarea id="adminAlertMsg" rows="3" placeholder="예) 21:30 포토 타임 시작합니다!"></textarea>
        <div style="margin-top:8px"><button class="btn acc" id="btnPushAlert">알림 보내기</button></div>
        <div class="hr"></div>
        <button class="btn warn" id="btnHardReset">⚠️ 모든 데이터 초기화</button>
      </div>
      <div class="col">
        <h3>미션/예약 관리(간단)</h3>
        <label>미션 프리셋(JSON)</label>
        <textarea id="adminMissions" rows="6"></textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="btnLoadMissions">미션 불러오기</button>
          <button class="btn ok" id="btnSaveMissions">미션 저장</button>
        </div>
        <div class="hr"></div>
        <label>예약자 프리셋(JSON)</label>
        <textarea id="adminGuests" rows="8"></textarea>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="btnLoadGuests">예약자 불러오기</button>
          <button class="btn ok" id="btnSaveGuests">예약자 저장</button>
          <button class="btn acc" id="btnSeed300" title="데모 게스트 300명 자동 생성">데모 300명 생성</button>
        </div>
        <p class="muted mini">* 성별 필드 포함(M/F). 생성 후 로그인 데모는 로그인 페이지의 자동입력으로 테스트 가능.</p>
      </div>
    </div>
  </section>

  </main>
  <script src="assets/app.js"></script>
  <script>
    App.ensureDefaults();
    App.mobileGuard();
    App.renderNav('admin');
    
(function(){
  const url = new URL(location.href);
  if(url.searchParams.get('admin')!=='1'){
    // hide admin if not enabled
    App.toast('관리자 모드는 ?admin=1 로 접근하세요.');
  }
  function renderAdmin(){
    document.getElementById('adminMissions').value = JSON.stringify(App.lsGet(App.KEY.missions, []), null, 2);
    document.getElementById('adminGuests').value = JSON.stringify(App.lsGet(App.KEY.guests, []), null, 2);
  }
  renderAdmin();
  document.getElementById('btnLoadMissions').addEventListener('click', renderAdmin);
  document.getElementById('btnSaveMissions').addEventListener('click', ()=>{
    try{ const j = JSON.parse(document.getElementById('adminMissions').value); App.lsSet(App.KEY.missions, j); App.toast('미션 저장 완료'); }
    catch(e){ App.toast('JSON 형식 오류'); }
  });
  document.getElementById('btnLoadGuests').addEventListener('click', renderAdmin);
  document.getElementById('btnSaveGuests').addEventListener('click', ()=>{
    try{ const j = JSON.parse(document.getElementById('adminGuests').value); App.lsSet(App.KEY.guests, j); App.toast('예약자 저장 완료'); }
    catch(e){ App.toast('JSON 형식 오류'); }
  });
  document.getElementById('btnHardReset').addEventListener('click', ()=>{
    if(confirm('모든 로컬 데이터(예약/미션/호감/스탬프/알림/로그인)를 초기화할까요?')){
      Object.values(App.KEY).forEach(k=> localStorage.removeItem(k));
      App.toast('초기화 완료 – 페이지를 새로고침하세요.');
    }
  });
  document.getElementById('btnSeed300').addEventListener('click', ()=>{
    const arr = App.genDemoGuests(300);
    App.lsSet(App.KEY.guests, arr);
    document.getElementById('adminGuests').value = JSON.stringify(arr, null, 2);
    App.toast('데모 300명 생성 완료');
  });
})();

  </script>
</body>
</html>
