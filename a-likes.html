<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=414, initial-scale=1, viewport-fit=cover" />
  <title>ì•Œë¦¼</title>
  <link rel="stylesheet" href="assets/app.css" />
  <style> 
    .toggle{padding:2px 8px; border-radius:12px; background:#f1f5f9; font-weight:700}
    .toggle.on{background:#e7f7ee; color:#137a3a}

    .ms-head{display:flex; align-items:center; justify-content:space-between}
    .ms-sub{display:flex; align-items:center; gap:8px}
    .badge-like{background:#eef5ff; color:#1b4b91; padding:2px 8px; border-radius:999px; font-weight:700}
    .ms-preview{margin:6px 0 0; color:#4b5563}

    .chip{padding:4px 8px; border-radius:999px; font-size:12px}
    .chip-wait{background:#f3f4f6; color:#6b7280}
    .chip-ok{background:#e9fff1; color:#187a42}
    .chip-error{background:#ffecec; color:#b91c1c}
    .chip-hold{background:#fff7e6; color:#b45309}

    .ms-actions{display:flex; gap:8px}
    .btn-pri{flex:1; padding:10px 12px; border-radius:10px; background:#5270ff; color:#fff; border:none}
    .btn-ghost{padding:10px 12px; border-radius:10px; background:#fff; border:1px solid #e5e7eb}
    .btn-icon{padding:10px; border-radius:10px; background:#fff; border:1px solid #e5e7eb}
    /* ===== Milestone(5ëª… ë„ë‹¬) UI ===== */
    .milestone-banner{
    position: sticky; top: 0; z-index: 5;
    background:#fff; padding:10px 12px; border-radius:12px;
    box-shadow:0 2px 12px rgba(0,0,0,.06); 
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom:12px;
    }
    .milestone-banner b{ font-size:16px; }
    .ms-ctrl{ display:flex; align-items:center; gap:8px; }

    .toggle{
    padding:6px 10px; border-radius:999px; border:1px solid #e5e7eb;
    background:#fff; font-weight:700; min-width:64px; text-align:center;
    }
    .toggle.on{ background:#e7f7ee; color:#137a3a; border-color:#b8e6c9; }

    .tabs-mini{ display:flex; gap:8px; margin:12px 0; }
    .tabs-mini button{
    flex:1; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb; background:#fff;
    }
    .tabs-mini .on{ border-color:#93c5fd; box-shadow:0 0 0 4px rgba(59,130,246,.12); }

    .ms-card{     
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 90%;
    margin: 10px auto;
    background-color: #fff;
    padding: 15px;
    border-radius: 20px;
    box-shadow: 0 0px 24px rgba(0, 0, 0, .10), 0 0px 0 rgba(0, 0, 0, 05);
    }
    .ms-head{ display:flex; align-items:center; justify-content:space-between; }
    .ms-sub{ display:flex; align-items:center; gap:8px; }
    .badge-like{ background:#eef5ff; color:#1b4b91; padding:2px 8px; border-radius:999px; font-weight:700; }
    .ms-preview{ margin:4px 0 0; color:#4b5563; }

    .chip{ padding:4px 8px; border-radius:999px; font-size:12px; }
    .chip-wait{ background:#f3f4f6; color:#6b7280; }
    .chip-ok{ background:#e9fff1; color:#187a42; }
    .chip-error{ background:#ffecec; color:#b91c1c; }
    .chip-hold{ background:#fff7e6; color:#b45309; }

    .ms-actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .ms-btn-pri{ flex:1; padding:10px 12px; border-radius:10px; background:#5270ff; color:#fff; border:none; }
    .ms-btn-ghost{ padding:10px 12px; border-radius:10px; background:#fff; border:1px solid #e5e7eb; }
    .ms-btn-icon{ padding:10px; border-radius:10px; background:#fff; border:1px solid #e5e7eb; }

    .ms-time{ font-size:12px; color:#8f8f8f; margin-left:auto; }
    .likes-select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
      margin: 10px 0;
      outline: none;
      background: white;
    }   
    .p-text {
        font-size: 14px;
    }
  </style>
</head>
<body>
    <section class="card" id="msCenter">
    <!-- ìƒíƒœ íƒ­ -->
    <div class="tabs-mini" id="msTabs">
        <button type="button" data-tab="wait" class="on">ë°œì†¡ ëŒ€ê¸°</button>
        <button type="button" data-tab="sent">ë°œì†¡ ì™„ë£Œ</button>
        <button type="button" data-tab="fail">ì‹¤íŒ¨</button>
    </div>

    <!-- ë¦¬ìŠ¤íŠ¸ -->
    <div class="list" id="msList"></div>
        <!-- í ì¹´ë“œ -->
        <div class="li ms-card">
        <div class="ms-head">
            <div>
            <b>ê¹€ë¯¼ìˆ˜</b> <span class="muted">(12)</span>
            </div>
            <span class="chip chip-wait">ëŒ€ê¸°</span>
        </div>

        <div class="ms-sub">
            <span class="badge-like">+5</span>
            <span class="muted">ìµœê·¼ 14:32</span>
        </div>
        <select id="selectTarget" class="likes-select">
          <option value="">â€œ5ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
          <option>â€œ3ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
          <option>â€œì„œë¡œ í˜¸ê°ì´ ìˆëŠ” ìƒëŒ€ê°€ ìƒê²¼ì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
        </select>

        <div class="ms-actions">
            <button class="btn-pri">ë³´ë‚´ê¸°</button>
            <button class="btn-ghost">ê±´ë„ˆë›°ê¸°</button>
            <button class="btn-icon" title="ë¡œê·¸"><span>ğŸ—’ï¸</span></button>
        </div>
        </div>
    </div>
    <div class="list" id="msList"></div>
        <!-- í ì¹´ë“œ -->
        <div class="li ms-card">
        <div class="ms-head">
            <div>
            <b>ê¹€ë¯¼ìˆ˜</b> <span class="muted">(12)</span>
            </div>
            <span class="chip chip-wait">ë°œì†¡ì™„ë£Œ</span>
        </div>

        <div class="ms-sub">
            <span class="badge-like">+5</span>
            <span class="muted">ìµœê·¼ 14:32</span>
        </div>
        <div>
          <p class="p-text">â€œ5ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</p>
        </div>
    </div>
    <div class="list" id="msList"></div>
        <!-- í ì¹´ë“œ -->
        <div class="li ms-card">
        <div class="ms-head">
            <div>
            <b>ê¹€ë¯¼ìˆ˜</b> <span class="muted">(12)</span>
            </div>
            <span class="chip chip-wait">ì‹¤íŒ¨</span>
        </div>

        <div class="ms-sub">
            <span class="badge-like">+5</span>
            <span class="muted">ìµœê·¼ 14:32</span>
        </div>
        <select id="selectTarget" class="likes-select">
          <option value="">â€œ5ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
          <option>â€œ3ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
          <option>â€œì„œë¡œ í˜¸ê°ì´ ìˆëŠ” ìƒëŒ€ê°€ ìƒê²¼ì–´ìš”. í™•ì¸í•´ ë³´ì„¸ìš”!â€</option>
        </select>

        <div class="ms-actions">
            <button class="btn-pri">ì¬ì „ì†¡</button>
            <button class="btn-ghost">ê±´ë„ˆë›°ê¸°</button>
            <button class="btn-icon" title="ë¡œê·¸"><span>ğŸ—’ï¸</span></button>
        </div>
        </div>
    </div>
  </section>

  </main>
  <script src="assets/app.js"></script>
  <script>
    App.renderNavAlt('alerts');

    (function(){
    // App ìœ í‹¸ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ë¡œì»¬ í´ë°±
    const hasApp = typeof window.App !== 'undefined';
    const lsGet = (k, fb) => hasApp ? App.lsGet(k, fb) : (JSON.parse(localStorage.getItem(k)) ?? fb);
    const lsSet = (k, v)   => hasApp ? App.lsSet(k, v)   : localStorage.setItem(k, JSON.stringify(v));
    const toast = (t)=> (hasApp && App.toast) ? App.toast(t) : alert(t);

    const KEY_Q   = 'evt.ms.queue';   // [{id,number,name,likes, status, at, sentAt?, failReason?}]
    const KEY_AUTO= 'evt.ms.auto';    // true/false

    // ë°ëª¨ ë°ì´í„°(ì²˜ìŒë§Œ)
    const seedIfEmpty = () => {
        const q = lsGet(KEY_Q, []);
        if (q.length) return;
        const now = Date.now();
        const demo = [
        {id:'m-12', number:12, name:'ê¹€ë¯¼ìˆ˜', likes:5, at:now-60_000, status:'wait'},
        {id:'m-47', number:47, name:'ì´í•˜ëŠ˜', likes:5, at:now-120_000, status:'wait'},
        {id:'m-83', number:83, name:'ë°•ì„œì—°', likes:7, at:now-180_000, status:'fail', failReason:'í†µì‹ ì‚¬ ì˜¤ë¥˜'}
        ];
        lsSet(KEY_Q, demo);
        if (lsGet(KEY_AUTO, null) === null) lsSet(KEY_AUTO, false);
    };

    // ìƒíƒœ
    let tab = 'wait';   // 'wait' | 'sent' | 'fail'
    const $count = document.getElementById('msCount');
    const $list  = document.getElementById('msList');
    const $tabs  = document.getElementById('msTabs');
    const $auto  = document.getElementById('msAuto');
    const $sendAll = document.getElementById('msSendAll');

    seedIfEmpty();

    // ë Œë”
    function fmtTime(ts){
        return new Date(ts).toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit',hour12:false});
    }
    function read(){ return lsGet(KEY_Q, []); }
    function write(arr){ lsSet(KEY_Q, arr); }

    function render(){
        const all = read();
        const wait = all.filter(x=>x.status==='wait').sort((a,b)=>b.at-a.at);
        const sent = all.filter(x=>x.status==='sent').sort((a,b)=>b.sentAt-a.sentAt);
        const fail = all.filter(x=>x.status==='fail').sort((a,b)=>b.at-a.at);

        $count.textContent = wait.length;
        $auto.classList.toggle('on', !!lsGet(KEY_AUTO,false));
        $auto.textContent = lsGet(KEY_AUTO,false) ? 'ON' : 'OFF';

        const data = tab==='wait' ? wait : (tab==='sent' ? sent : fail);

        $list.innerHTML = data.map(x => {
        const chip = x.status==='wait' ? 'chip-wait' : (x.status==='sent' ? 'chip-ok' : 'chip-error');
        const chipTxt = x.status==='wait' ? 'ëŒ€ê¸°' : (x.status==='sent' ? 'ì „ì†¡ë¨' : 'ì‹¤íŒ¨');
        const timeTxt = x.status==='sent' ? fmtTime(x.sentAt) : fmtTime(x.at);
        const reason  = x.status==='fail' ? `<span class="muted">(${x.failReason||'ì‚¬ìœ  ë¯¸ìƒ'})</span>` : '';

        return `
            <div class="li ms-card" data-id="${x.id}">
            <div class="ms-head">
                <div><b>${x.name}</b> <span class="muted">(${x.number})</span></div>
                <span class="chip ${chip}">${chipTxt}</span>
            </div>

            <div class="ms-sub">
                <span class="badge-like">+${x.likes}</span>
                <span class="ms-time">${timeTxt}</span>
            </div>

            <p class="ms-preview">â€œ${x.likes}ëª…ì´ ë‹¹ì‹ ì—ê²Œ í˜¸ê°ì„ ë³´ëƒˆì–´ìš”. ì•±ì—ì„œ í™•ì¸í•´ ë³´ì„¸ìš”!â€ ${reason}</p>

            <div class="ms-actions">
                ${x.status==='wait' ? `
                <button type="button" class="ms-btn-pri" data-act="send">ë³´ë‚´ê¸°</button>
                <button type="button" class="ms-btn-ghost" data-act="skip">ê±´ë„ˆë›°ê¸°</button>
                ` : x.status==='fail' ? `
                <button type="button" class="ms-btn-pri" data-act="retry">ì¬ì‹œë„</button>
                <button type="button" class="ms-btn-ghost" data-act="skip">ë³´ë¥˜</button>
                ` : `
                <button type="button" class="ms-btn-ghost" data-act="remove">ê¸°ë¡ ì‚­ì œ</button>
                `}
                <button type="button" class="ms-btn-icon" data-act="preview" title="ë¯¸ë¦¬ë³´ê¸°">ğŸ—’ï¸</button>
            </div>
            </div>
        `;
        }).join('');
    }

    // ë™ì‘
    function doSend(item){
        // ì—¬ê¸°ì„œ ì‹¤ì œ SMS API ì—°ë™ì´ ë  ìë¦¬. ì§€ê¸ˆì€ ì„±ê³µ ì²˜ë¦¬ë§Œ.
        item.status = 'sent';
        item.sentAt = Date.now();
        toast(`ì „ì†¡ ì™„ë£Œ: ${item.name}`);
    }
    function doFail(item, reason='ì „ì†¡ ì‹¤íŒ¨'){
        item.status = 'fail';
        delete item.sentAt;
        item.failReason = reason;
        toast(`${reason}: ${item.name}`);
    }

    // ìë™ë°œì†¡
    function autoTick(){
        const auto = !!lsGet(KEY_AUTO,false);
        if (!auto) return;
        const all = read();
        const firstWait = all.find(x => x.status==='wait');
        if (firstWait){
        doSend(firstWait);
        write(all);
        render();
        }
    }
    const autoTimer = setInterval(autoTick, 1500); // 1.5ì´ˆ ê°„ê²©ìœ¼ë¡œ í•˜ë‚˜ì”© ì²˜ë¦¬

    // ì´ë²¤íŠ¸: íƒ­ ì „í™˜
    $tabs.addEventListener('click', (e)=>{
        const b = e.target.closest('button[data-tab]');
        if(!b) return;
        [...$tabs.children].forEach(x=>x.classList.toggle('on', x===b));
        tab = b.dataset.tab;
        render();
    });

    // ì´ë²¤íŠ¸: í† ê¸€
    $auto.addEventListener('click', ()=>{
        const cur = !!lsGet(KEY_AUTO,false);
        lsSet(KEY_AUTO, !cur);
        render();
    });

    // ì´ë²¤íŠ¸: ë¦¬ìŠ¤íŠ¸ ì•¡ì…˜
    $list.addEventListener('click', (e)=>{
        const btn = e.target.closest('[data-act]');
        if(!btn) return;
        const act = btn.dataset.act;
        const card = e.target.closest('.ms-card');
        const id = card?.dataset.id;
        if(!id) return;
        const all = read();
        const item = all.find(x=>x.id===id);
        if(!item) return;

        if (act==='send') doSend(item);
        else if (act==='retry') doSend(item);     // ë°ëª¨ì—ì„  ì¬ì‹œë„=ì„±ê³µ
        else if (act==='skip'){ item.status='hold'; toast('ë³´ë¥˜ ì²˜ë¦¬'); } // ë³´ë¥˜ ìƒíƒœ(ë¦¬ìŠ¤íŠ¸ì—” ì•ˆ ë³´ì„)
        else if (act==='remove'){ const i = all.indexOf(item); if(i>=0) all.splice(i,1); toast('ê¸°ë¡ ì‚­ì œ'); }
        else if (act==='preview'){ toast('ë¯¸ë¦¬ë³´ê¸°: ' + (item.likes)+'ëª… ì•Œë¦¼'); }

        write(all);
        render();
    });

    // ì¼ê´„ ë°œì†¡
    document.getElementById('msSendAll').addEventListener('click', ()=>{
        const all = read();
        const waits = all.filter(x=>x.status==='wait');
        if (waits.length===0){ toast('ëŒ€ê¸° í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.'); return; }
        waits.forEach(doSend);
        write(all); render();
    });

    render();
    })();
    </script>

</body>
</html>
